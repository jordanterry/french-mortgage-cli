# Release Process

This document describes how to create a new release of the French Property Investment Analyzer.

## Prerequisites

- Git repository is clean (no uncommitted changes)
- All Python tests pass
- You have push access to the GitHub repository
- GitHub CLI (`gh`) is installed and authenticated
- Homebrew tap repository is cloned at `../homebrew-tap`
- Python 3.8 or later installed

## Automated Release

The entire release process is automated via a single script:

```bash
./scripts/release.sh <version>
```

### Example

```bash
./scripts/release.sh 2.0.0
```

### What the Script Does

The release script performs these steps automatically:

1. **Validates working directory** - Ensures no uncommitted changes
2. **Updates version** - Modifies `version.properties` with new version
3. **Runs Python tests** - Executes `python3 python/tests/test_french_mortgage.py`
4. **Updates Homebrew formula version** - Updates version and URL in `Formula/french-property-investment.rb`
5. **Commits changes** - Commits version and formula updates
6. **Creates git tag** - Tags the release as `v<version>`
7. **Pushes to GitHub** - Pushes commits and tag
8. **Creates GitHub release** - Creates release (tarball automatically generated by GitHub)
9. **Downloads and calculates SHA256** - Downloads the release tarball and computes hash
10. **Updates formula with SHA256** - Updates the formula with correct SHA256
11. **Force pushes updated commits** - Amends commit with SHA256
12. **Updates Homebrew tap** - Updates the tap repository with new formula

### Version Format

Versions must follow semantic versioning:

- **MAJOR.MINOR.PATCH** (e.g., `1.0.1`, `1.1.0`, `2.0.0`)

Examples:
- `1.0.1` - Patch release (bug fixes)
- `1.1.0` - Minor release (new features, backwards compatible)
- `2.0.0` - Major release (breaking changes)

## Manual Release (Not Recommended)

If you need to release manually, follow these steps:

### 1. Update Version

Edit `version.properties`:
```properties
version=1.0.1
```

### 2. Run Tests

```bash
python3 python/tests/test_french_mortgage.py
```

### 3. Create GitHub Release

```bash
git add version.properties
git commit -m "Release v2.0.0"
git tag -a v2.0.0 -m "Release v2.0.0"
git push origin main v2.0.0
gh release create v2.0.0 --title "v2.0.0" --notes "Python release"
```

### 4. Calculate SHA256 of Tarball

```bash
curl -sL https://github.com/jordanterry/french-mortgage-cli/archive/refs/tags/v2.0.0.tar.gz | shasum -a 256
```

### 5. Update Formula

Edit `Formula/french-property-investment.rb`:
- Update `version` line
- Update `url` with new version (archive tarball URL)
- Update `sha256` with calculated hash

### 6. Commit Formula Update

```bash
git add Formula/french-property-investment.rb
git commit --amend --no-edit
git push -f origin main v2.0.0
```

### 7. Update Homebrew Tap

```bash
cd ../homebrew-tap
cp ../french-mortgage-cli/Formula/french-property-investment.rb Formula/
git add Formula/
git commit -m "Update french-property-investment to v2.0.0"
git push
```

## Post-Release

After a release:

1. **Verify installation** - Test that users can install via Homebrew:
   ```bash
   brew update
   brew upgrade french-property-investment
   french-property-investment --help
   ```

2. **Update CHANGELOG** - Document changes in `CHANGELOG.md` (if exists)

3. **Announce** - Share the release on relevant channels

## Troubleshooting

### Tests Fail

Ensure Python is installed and tests pass:
```bash
python3 --version
python3 python/tests/test_french_mortgage.py
```

### Formula SHA256 Mismatch

Recalculate from the GitHub tarball:
```bash
curl -sL https://github.com/jordanterry/french-mortgage-cli/archive/refs/tags/v<version>.tar.gz | shasum -a 256
# Update Formula/french-property-investment.rb with new hash
```

### GitHub Release Failed

Create manually:
```bash
gh release create v<version> --title "v<version>" --notes "Release notes"
```

### Homebrew Tap Not Found

The script expects the tap repository at `../homebrew-tap`. Either:
- Clone it: `cd .. && git clone https://github.com/jordanterry/homebrew-tap.git`
- Update manually as shown in the script's warning message

## Version Storage

The project version is stored in `version.properties`:

```properties
version=1.0.0
```

This single source of truth is read by:
- `scripts/release.sh` - Updates during release
- Documentation references

The Homebrew formula (`Formula/french-property-investment.rb`) is automatically updated by the release script.

## Python Migration Notes

The project has migrated from Kotlin/JVM to Python (v2.0.0+):

- **Python script**: `python/src/french_mortgage.py`
- **Tests**: `python/tests/test_french_mortgage.py` (23 comprehensive tests)
- **Homebrew**: Installs Python script via source tarball (not JAR)
- **Claude Skill**: Available in `skills/french-property-investment/`

The Kotlin implementation remains in the repository but is no longer actively maintained.
